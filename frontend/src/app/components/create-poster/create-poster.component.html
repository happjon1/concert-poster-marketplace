<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Header -->
      <div class="mb-5 text-center">
        <h1 class="display-5 fw-bold">Create Poster Listing</h1>
        <p class="text-muted lead">
          Share your concert art with potential buyers
        </p>
      </div>

      <!-- Alert -->
      <div
        class="alert alert-danger d-flex align-items-center mb-4"
        *ngIf="errorMessage">
        <i class="bi bi-exclamation-triangle-fill me-2 fs-5"></i>
        <div>{{ errorMessage }}</div>
      </div>

      <!-- Form -->
      <form [formGroup]="posterForm" *ngIf="posterForm" (ngSubmit)="onSubmit()">
        <div class="bs-stepper shadow-sm rounded">
          <!-- Stepper header -->
          <div class="bs-stepper-header p-3 bg-light border-bottom">
            <!-- Step 1 -->
            <div class="step" data-target="#basic-info">
              <button type="button" class="step-trigger" (click)="goToStep(0)">
                <span class="bs-stepper-circle bg-primary text-white">1</span>
                <span class="bs-stepper-label">Basic Info</span>
              </button>
            </div>

            <div class="line"></div>

            <!-- Step 2 -->
            <div class="step" data-target="#artists">
              <button type="button" class="step-trigger" (click)="goToStep(1)">
                <span class="bs-stepper-circle bg-primary text-white">2</span>
                <span class="bs-stepper-label">Artists</span>
              </button>
            </div>

            <div class="line"></div>

            <!-- Step 3 -->
            <div class="step" data-target="#events">
              <button type="button" class="step-trigger" (click)="goToStep(2)">
                <span class="bs-stepper-circle bg-primary text-white">3</span>
                <span class="bs-stepper-label">Events</span>
              </button>
            </div>

            <div class="line"></div>

            <!-- Step 4 -->
            <div class="step" data-target="#images">
              <button type="button" class="step-trigger" (click)="goToStep(3)">
                <span class="bs-stepper-circle bg-primary text-white">4</span>
                <span class="bs-stepper-label">Images</span>
              </button>
            </div>

            <div class="line"></div>

            <!-- Step 5 -->
            <div class="step" data-target="#listing-details">
              <button type="button" class="step-trigger" (click)="goToStep(4)">
                <span class="bs-stepper-circle bg-primary text-white">5</span>
                <span class="bs-stepper-label">Listing Details</span>
              </button>
            </div>
          </div>

          <!-- Stepper content -->
          <div class="bs-stepper-content p-0">
            <!-- Step 1 content -->
            <div id="basic-info" class="content p-4 fade" role="tabpanel">
              <app-basic-info-form
                [parentForm]="posterForm"></app-basic-info-form>
            </div>

            <!-- Step 2 content -->
            <div id="artists" class="content p-4 fade" role="tabpanel">
              <app-artist-selector
                [parentForm]="posterForm"
                [artists]="artists"
                [filteredArtists]="filteredArtists"
                (artistSearch)="filterArtists($event)"
                (addArtist)="addArtist($event)"
                (removeArtist)="removeArtist($event)">
              </app-artist-selector>
            </div>

            <!-- Step 3 content -->
            <div id="events" class="content p-4 fade" role="tabpanel">
              <app-event-selector
                [parentForm]="posterForm"
                [events]="events"
                [filteredEvents]="filteredEvents"
                (eventSearch)="filterEvents($event)"
                (addEvent)="addEvent($event)"
                (removeEvent)="removeEvent($event)">
              </app-event-selector>
            </div>

            <!-- Step 4 content -->
            <div id="images" class="content p-4 fade" role="tabpanel">
              <app-image-uploader
                [parentForm]="posterForm"
                [uploadedImages]="uploadedImages"
                [maxImages]="maxImages"
                [isUploading]="isUploading"
                [activeImageIndex]="activeImageIndex"
                (fileSelected)="onFileSelected($event)"
                (setActiveImage)="setActiveImage($event)"
                (removeImage)="removeImage($event)">
              </app-image-uploader>
            </div>

            <!-- Step 5 content -->
            <div id="listing-details" class="content p-4 fade" role="tabpanel">
              <app-listing-details-form
                [parentForm]="posterForm"
                [listingType]="listingType">
              </app-listing-details-form>
            </div>
          </div>
        </div>

        <!-- Sticky Navigation Buttons -->
        <div class="sticky-nav-buttons">
          <div class="container">
            <div class="d-flex justify-content-between">
              <!-- Back button (hidden on first step) -->
              <button
                *ngIf="getCurrentStepIndex() > 0"
                type="button"
                class="btn btn-outline-primary px-4 border-2"
                (click)="previous()">
                <i class="bi bi-chevron-left me-1"></i> Back
              </button>
              <div *ngIf="getCurrentStepIndex() === 0"></div>

              <!-- Next button (not on last step) -->
              <button
                *ngIf="getCurrentStepIndex() < 4"
                type="button"
                class="btn btn-primary text-white px-4"
                (click)="next()">
                Next <i class="bi bi-chevron-right ms-1"></i>
              </button>

              <!-- Submit button (only on last step) -->
              <button
                *ngIf="getCurrentStepIndex() === 4"
                type="submit"
                class="btn btn-success text-white px-4"
                [disabled]="posterForm.invalid || isSubmitting">
                <span
                  *ngIf="isSubmitting"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"></span>
                Create Listing
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
