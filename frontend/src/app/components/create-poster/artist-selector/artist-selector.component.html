<div class="card shadow-sm mb-4">
  <div class="card-header bg-white py-3">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <span class="badge bg-primary rounded-pill me-2">2</span>
        <h5 class="mb-0">Artists</h5>
      </div>
      <span class="badge bg-light text-dark"
        >{{ artistIdsArray.length }} selected</span
      >
    </div>
  </div>
  <div class="card-body p-4">
    <!-- Search -->
    <div class="input-group mb-3">
      <span class="input-group-text bg-white">
        <i class="bi bi-search"></i>
      </span>
      <input
        type="text"
        class="form-control"
        placeholder="Search artists..."
        [(ngModel)]="artistSearchTerm"
        (input)="onSearch()" />
    </div>

    <!-- Results -->
    <div class="mb-3">
      <div class="list-group" style="max-height: 250px; overflow-y: auto">
        <button
          *ngFor="let artist of filteredArtists"
          type="button"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          (click)="onAddArtist(artist)">
          <span>{{ artist.name }}</span>
          <i class="bi bi-plus-circle"></i>
        </button>
        <!-- Add this loading indicator inside your search results area -->
        <div
          *ngIf="isSearchingArtists"
          class="d-flex justify-content-center my-3">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <!-- No results message should consider loading state -->
        <div
          *ngIf="filteredArtists.length === 0 && !isSearchingArtists"
          class="text-center text-muted my-3">
          No artists found matching "{{ artistSearch }}"
        </div>
      </div>
    </div>

    <!-- Selected Artists -->
    <div *ngIf="artistIdsArray.controls.length > 0" class="mb-3">
      <label for="selectedArtists" class="form-label">Selected Artists</label>
      <div id="selectedArtists" class="d-flex flex-wrap gap-2">
        <div
          *ngFor="let artistIdControl of artistIdsArray.controls; let i = index"
          class="badge bg-primary d-flex align-items-center py-2 px-3">
          {{ getArtistName(artistIdControl.value) }}
          <button
            type="button"
            class="btn-close btn-close-white ms-2"
            (click)="onRemoveArtist(i)">
            <span class="visually-hidden">Remove artist</span>
          </button>
        </div>
      </div>
    </div>

    <div
      class="invalid-feedback d-block"
      *ngIf="
        parentForm.get('artistIds')?.touched &&
        parentForm.get('artistIds')?.invalid
      ">
      Please select at least one artist
    </div>
  </div>
</div>
